# 1.极光短信接口

```xml
  <!--极光接口-->
    <dependency>
      <groupId>cn.jpush.api</groupId>
      <artifactId>jiguang-common</artifactId>
      <version>1.0.8</version>
    </dependency>
    <dependency>
      <groupId>cn.jpush.api</groupId>
      <artifactId>jsms-client</artifactId>
      <version>1.2.9</version>
    </dependency>
    <dependency>
      <groupId>com.google.code.gson</groupId>
      <artifactId>gson</artifactId>
      <version>2.3</version>
    </dependency>
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-api</artifactId>
      <version>1.7.7</version>
    </dependency>

```

```java
import cn.jiguang.common.resp.APIConnectionException;
import cn.jiguang.common.resp.APIRequestException;
import cn.jsms.api.SendSMSResult;
import cn.jsms.api.common.SMSClient;
import cn.jsms.api.common.model.SMSPayload;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException; 
 
@Component //交给spring管理
public class JGSmsUtil {
 
    // masterSecret https://www.jiguang.cn/dev2/#/overview/appCardList 开发者服务--->应用设置--->应用信息--> Master Secret
    public String masterSecret = "xxxx";
 
    //appKey https://www.jiguang.cn/dev2/#/overview/appCardList 开发者服务--->应用设置--->应用信息--> Master Secret
    public String appKey = "xxxxx";
 
    //初始化发短信客户端
    private SMSClient smsClient = new SMSClient(masterSecret, appKey);
 
    /**
     * 发送模板短信-验证码 示例1
     *
     * @param phoneNumber
     * create 2019/12/26 by kingyifan
     */
    public void sendSMSCode(String phoneNumber, String code) {
        try {//构建发送短信
            SMSPayload payload = SMSPayload.newBuilder()
                    .setMobileNumber(phoneNumber) // 手机号码
                    .setTempId(1)            // 短信模板ID 需要自行申请 模板id为：1的则自带验证码模板id
                    .addTempPara("code", code)  // key模板参数value：参数值  您的手机验证码：{{code}}，有效期5分钟，请勿泄露。如非本人操作，请忽略此短信。谢谢！
                    .setSignId(xxxx)// 签名id 需要自行申请审核。个人也可以申请
                    .build();
 
            //发送短信 会返回msg_id
            SendSMSResult res = smsClient.sendTemplateSMS(payload);
            //执行业务/
            //指向保存短信发送记录业务逻辑 可以直接扔到MQ
            /**
             * 第一个参数极光返回的消息id
             * 第二个发送的手机号
             * 第三个发送内容
             * 第四个发送时间
             * 保存到DB
             */
            //insertSendSmsLog(res.getMessageId(),phoneNumber,code,0,System.currentTimeMillis()/1000);
            //执行业务/
 
        } catch (APIConnectionException e) {
            e.printStackTrace();
        } catch (APIRequestException e) {
            e.printStackTrace();
        }
    }
 
    /**
     * 发送模板短信-取快递 示例2
     *
     * @param phoneNumber 手机号
     * @param name        名字
     * @param address     地址
     *                    <p>
     *                    create 2019/12/26 by kingyifan
     */
    public void sendSMSOther(String name, String address, String phoneNumber) {
        try {
            SMSPayload payload = SMSPayload.newBuilder()
                    .setMobileNumber(phoneNumber) // 手机号码
                    .setTempId(xxxx)            // 短信模板ID 需要自行申请
                    .addTempPara("name", name)  // key模板参数value：参数值  尊敬的{{name}}，您的快递到{{address}}，请速来取一下。
                    .addTempPara("address", address)  // key模板参数value：参数值  尊敬的{{name}}，您的快递到{{address}}，请速来取一下。
                    .setSignId(xxxx)// 签名id 需要自行申请审核。个人也可以申请
                    .build();
 
            //发送短信
            SendSMSResult res = smsClient.sendTemplateSMS(payload);
            //执行业务/
            //指向保存短信发送记录业务逻辑 可以直接扔到MQ
            /**
             * 第一个参数极光返回的消息id
             * 第二个发送的手机号
             * 第三个发送内容
             * 第四个发送时间
             * 保存到DB
             */
            //insertSendSmsLog(res.getMessageId(),phoneNumber,code,0,System.currentTimeMillis()/1000);
            //执行业务/
        } catch (APIConnectionException e) {
            e.printStackTrace();
        } catch (APIRequestException e) {
            e.printStackTrace();
        }
    }
 
    /**
     * SHA1加密
     *
     * @param strSrc 明文
     * @return 加密之后的密文
     */
    public static String encrypt(String strSrc) {
        MessageDigest md = null;
        String strDes = null;
        byte[] bt = strSrc.getBytes();
        try {
            md = MessageDigest.getInstance("SHA-1");// 将此换成SHA-1、SHA-512、SHA-384等参数
            md.update(bt);
            strDes = bytes2Hex(md.digest()); // to HexString
        } catch (NoSuchAlgorithmException e) {
            return null;
        }
        return strDes;
    }
 
    /**
     * byte数组转换为16进制字符串
     *
     * @param bts 数据源
     * @return 16进制字符串
     */
    private static String bytes2Hex(byte[] bts) {
        String des = "";
        String tmp = null;
        for (int i = 0; i < bts.length; i++) {
            tmp = (Integer.toHexString(bts[i] & 0xFF));
            if (tmp.length() == 1) {
                des += "0";
            }
            des += tmp;
        }
        return des;
    }
 
    /**
     * 延签判断是否是极光回调
     *
     * @param signature
     * @param nonce
     * @param timestamp
     * @return create kingyifan by  on 2019.12.26
     */
    public Boolean checkSign(String signature, String nonce, String timestamp) {
        //加密进行比对
        String str = String.format("appKey=%s&appMasterSecret=%s&nonce=%s×tamp=%s",
                appKey, masterSecret, nonce, timestamp);
        String new_signature = encrypt(str);
        if (signature.equals(new_signature)) {
            return true;
        }
        return false;
    }
}

```

# 2.阿里云短信接口

```xml
    <dependency>
            <groupId>com.aliyun</groupId>
            <artifactId>aliyun-java-sdk-core</artifactId>
            <version>4.5.3</version>
```

```properties
#用户名
sms.username =LTAI4GJwiUy8FSYQRAMxpwot
#密码
sms.password =9BoOC6vh0lOC4YhXU1piYFayeVlmAm
#接收人手机号,多个手机号用英文逗号隔开
sms.toPhone=13536299557
#变量名
sms.sign =code
#短信模板
sms.template=SMS_205445111
```

```java
import com.aliyuncs.CommonRequest;
import com.aliyuncs.CommonResponse;
import com.aliyuncs.DefaultAcsClient;
import com.aliyuncs.IAcsClient;
import com.aliyuncs.exceptions.ClientException;
import com.aliyuncs.exceptions.ServerException;
import com.aliyuncs.http.MethodType;
import com.aliyuncs.profile.DefaultProfile;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class SMSUtil {
    @Value("${sms.username}")
    private String username;
    @Value("${sms.password}")
    private String password;
    @Value("${sms.toPhone}")
    private String toPhone;
    @Value("${sms.sign}")
    private String sign;
    @Value("${sms.template}")
    private String template;
        public  void  sendsms() {
            DefaultProfile profile = DefaultProfile.getProfile("cn-hangzhou", username, password);
            IAcsClient client = new DefaultAcsClient(profile);
            /*固定写法*/
            CommonRequest request = new CommonRequest();
            request.setSysMethod(MethodType.POST);
            request.setSysDomain("dysmsapi.aliyuncs.com");
            request.setSysVersion("2017-05-25");
            request.setSysAction("SendSms");
            request.putQueryParameter("RegionId", "cn-hangzhou");
            /*创建短信*/
            //接收人手机号,多个手机号用英文逗号隔开
            request.putQueryParameter("PhoneNumbers", toPhone);
            //标签名（变量名）
            request.putQueryParameter("SignName", sign);
            //短信模板
            request.putQueryParameter("TemplateCode", template);
             //短信模板变量名
            String str = String.valueOf(new Random().nextInt(899999) + 100000);
            int code = Integer.parseInt(str);
            request.putQueryParameter("TemplateParam", "{\"code\":\"" + code + "\"}");
            try {
                CommonResponse response = client.getCommonResponse(request);
                System.out.println(response.getData());
            } catch (ServerException e) {
                e.printStackTrace();
            } catch (ClientException e) {
                e.printStackTrace();
            }
    }
}
```

#  3.邮箱发送功能

```xml
<dependency>
            <groupId>javax.activation</groupId>
            <artifactId>activation</artifactId>
            <version>1.1</version>
        </dependency>
        <dependency>
            <groupId>javax.mail</groupId>
            <artifactId>mail</artifactId>
            <version>1.4.7</version>
        </dependency>
//spring-content-support.jar
```

```properties
#邮箱配置
mail.host=smtp.qq.com
mail.username=1324747110@qq.com
mail.password=kthcouunjwiyjibg
mail.protocol=smtp
#默认465/587      25端口被阿里云禁用
mail.port=465
mail.default=UTF-8
mail.properties.mail.smtp.auth= true
mail.properties.mail.smtp.timeout=5000
mail.properties.mail.smtp.ssl.enable=true
email.default.to=1324747110@qq.com,1076127198@qq.com,1195317391@qq.com
email.default.subject=Hello
#邮箱发送开关
email.switch=false
```

```java
import freemarker.template.Template;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Component;
import org.springframework.ui.freemarker.FreeMarkerTemplateUtils;
import org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;
import java.util.HashMap;
import java.util.Map;

@Component
public class MailUtils {
    @Value("${mail.username}")
    private String from;
    @Value("${email.default.to}")
    private String[] to;
    @Value("${email.default.subject}")
    private String subject;
    @Value("${email.switch}")
    private boolean b;

    @Autowired
    private JavaMailSender mailSender;

    @Autowired
    private FreeMarkerConfigurer freeMarkerConfigurer;

    private static final String ENCODING = "utf-8";
    public void setFreeMarkerConfigurer(FreeMarkerConfigurer freeMarkerConfigurer) {
        this.freeMarkerConfigurer = freeMarkerConfigurer;
    }

    public void sendMail() throws MessagingException {
        if(b==true){
            //创建邮件
            MimeMessage  message = mailSender.createMimeMessage();
            try {
                //设置
                MimeMessageHelper helper = new MimeMessageHelper(message, true,"utf8");
                //用于接收邮件的邮箱
                helper.setTo(to);
                //邮件的主题
                helper.setSubject(subject);
                //发送人
                helper.setFrom(from);
                //邮件的正文,true为打开html文本邮件
                Map<String, Object> model = new HashMap<>();
                model.put("href","http://www.baidu.com");
                model.put("name","系统管理员");
                model.put("content","您有新的订单，请及时处理！！");
                Template template =freeMarkerConfigurer.getConfiguration().getTemplate("mail.ftl");
                String html = FreeMarkerTemplateUtils.processTemplateIntoString(template,model);
                helper.setText(html,true);
                //发送邮件
                mailSender.send(message);
                System.out.println("邮件发送成功...");
            } catch (Exception e) {
                throw new MessagingException("failed to send mail!", e);
            }
        }else{
            System.out.println("发送功能已关闭！");
        }

    }
}
```

