# winjay的工作笔记

|      名称       |                             网址                             | 账号                             |        密码        |
| :-------------: | :----------------------------------------------------------: | -------------------------------- | :----------------: |
|   OA后台网址    |       http://120.77.255.223:1010/system-api/sso/index        | admin                            |  Z9wC3kUMSG0LYbc2  |
|  同略官网后台   |              http://www.tongluegroup.com/login               | admin                            | tonglewkeji_11_yfb |
|  禅道任务平台   |                  http://120.77.255.223:8889                  | wangwenjie                       |    6693155peter    |
| 公司产品库/SVN  |               https://120.76.41.162:8002/svn/                | wangwj                           |      tl123456      |
|       OA        |       http://120.77.255.223:1010/system-api/sso/index        | wangwenjie                       |      20201009      |
|    极光短信     |           https://www.jiguang.cn/dev2/#/intro/push           | 1324747110                       |      123456Ok      |
|    上网认证     | http://192.168.100.100:7755/login.cgi?s=192.168.100.100&p=5280&auths=127.0.0.1&authp=7755&authmethod=1 | wangwenjie                       |       123456       |
|   远程khtest    |                     121.8.142.106:50001                      | Safeos19910#                     |                    |
|  远程khproduce  |                     121.8.142.106:60008                      | Safeosl9910#                     |                    |
| szh和官网服务器 |                      120.76.41.162:6389                      | administrator 20191202a#&f83)efg |      端口162       |
|  oaxz平台服器   |                        120.77.255.223                        | @dmxd813614@                     |      端口223       |

 官网：F:\deployee\TLGW-tomcat-8.0.50 

 运营平台：F:\work\frame-szh  8596和8699

远程登录  控制台命了 mstsc

 ssh：192.168.14.71:5003   登陆信息:root/tonglew   应用端口：5004->8080 

## 1、数据库相关笔记

连接名：120.77.255.223
账号：root
密码：DcmaXnmiXXyEo9FE

![1604539895919](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1604539895919.png)



uuid生成语句：SELECT REPLACE(UUID(), '-', '');

excel UUID生成函数

```mysql
=LOWER(CONCATENATE(DEC2HEX(RANDBETWEEN(0,POWER(16,8)),8),"",DEC2HEX(RANDBETWEEN(0,POWER(16,4)),4),"","4",DEC2HEX(RANDBETWEEN(0,POWER(16,3)),3),"",DEC2HEX(RANDBETWEEN(8,11)),DEC2HEX(RANDBETWEEN(0,POWER(16,3)),3),"",DEC2HEX(RANDBETWEEN(0,POWER(16,8)),8),DEC2HEX(RANDBETWEEN(0,POWER(16,4)),4)))
```

员工姓名及id

```sql
SELECT realname,user_id from upms_user
where realname 
in(
'王志武','冯德明','裴伟','陈锋','俞菲','李丽玉','秦建军','黄婷','杨政','陈凯鸿','文多运','莫秋梦','杨帆','刘燕','王鑫磊','金敬钊','杨光','李清媛','吕家瑜','谭恩杰','余远智','李定昆','彭纪宁','陈里福','夏宇迪','何源辉',
'陈建操','郭嘉宝','陈沐荣','吴泳彤','谭敏华','何坤洋','杨文章','吴鸿春','植煜焕','刘国平','王达舜','黄超','肖文文','魏锦豪','张佳','陈炳应','杜诗良','黄展强','陈渐泉','李关泰','陈智聪','赖洪活','冼业坤','张政','霍金芳',
'王子顺','崔成业','钟胜雁','黄鹤翱','叶海峰','董亮庭','赵剑','孟祥力','郑晓莉','卢建新','曾丽枚','巴龙','杨婕','廖梅芳','李石秀','钟明珠','梁文佳','李俊健','黄道宏','何伟')
```

**常用数据库：**

|   数据库名   |            备注            |
| :----------: | :------------------------: |
|  frame-szh   |         运营平台库         |
|  frame-tloa  |          工时系统          |
|  oaproject   |          同略OA库          |
| oaproject-xz |          协政OA库          |
|   tl-gyxxk   | OA视图，用户信息，项目信息 |

角色id：33 普通员工； 44 项目主管；32 部门经理

**同略（tl-gyxxk）常用表**

|         表名         |   备注   |
| :------------------: | :------: |
| xmgl_project_records | 项目信息 |
|  upms_organization   | 部门信息 |
|      upms_user       | 用户信息 |

**OA（oaproject）常用表**

|           表名           |                 备注                 |
| :----------------------: | :----------------------------------: |
|   oa_reimburse approve   |   同略报销（process_Instance_Id）    |
| oa_reimburse approvex_xz |   协政报销（process_Instance_Id）    |
|        upms_role         | 用户角色表（33公司员工；44项目主管） |
|     upms_ user_role      |           用户与角色关系表           |
|      **upms_user**       |    **OA的用户表（tl-gyxxk库中）**    |
|         sys_user         |       用户表（frame_tloa库中）       |

**运营（frame-szh）常用的表**

|             表名             |         备注          |
| :--------------------------: | :-------------------: |
|    t_administrator_leave     | 请假表（instance_id） |
| t_administrator_workovertime | 加班表（instance_id） |
|       t_purchase_apply       | 采购表（instance_id） |
|            t_xmxx            |    项目管理信息表     |
|      t_project_info_ext      |    项目扩展信息表     |
|        t_project_info        |   项目扩展信息主表    |
|          sys_organ           |      运营部门表       |

查询以上对应的instance_id，先删除下面两个表再删除主表

**运营待办表**

- extend_act_tasklog		
- t_sys_todo	

**OA待办表**

- act_ru_task			待办表（proc_Instance_Id）
-  act_ru_task这个是实时记录表，每次流转，会将当前记录删除，插入下个环节的待办信息，流程结束的话，这个表相关记录就会全部删除 

 **运营平台这边要删两张表的待办，oa报销这边只用删一张表的待办**

<a style="color:red"> **测试的时候一定要把原数据删掉，不要只删待办，运营删三个表的数据，OA只需两个表** </a>

### 数据库查询笔记

#### 1.根据模糊字段查询项目编号、名称

```sql
#根据条件查询t_project_info表的相关信息
SELECT 
PROJECT_NAME as '项目名称',
PROJECT_CODE as '项目编号',MARKET_PROJECT_CODE as '市场编号',
SALE_NAME as '销售人员'
FROM `t_project_info`
WHERE IS_HISTORY = 0 and (PROJECT_CODE like '2%' or MARKET_PROJECT_CODE like '2%')
```

#### 2.根据姓名查询项目工时、填报内容

```sql
SELECT d.name "部门名称",e.project_name "项目名称",e.project_no "项目编号",
a.workday "日志日期",
a.create_name "员工姓名",b.duration "工时时长",
(case when b.type='BMGS' then '部门工时'
	when
 b.type='XMGS' then '项目工时'
	when b.type='QJGS' then '请假工时'
	when b.type='XZGS'
 then '协作工时'
when b.type='TXGS' then '调休工时'
	else b.type end) "工时类别" 
FROM
 `frame-tloa`.t_working_record_main a 
left join t_working_record_sub b on a.id=b.record_id
 left
 join sys_organ d on b.department_id=d.id
 left join t_project_project e on e.id=b.project_id
where a.workday>='2019-09-01' and a.workday<='2019-12-31'
and a.`status`='1' and
 b.duration is not null and e.project_name = '医疗服务价格动态调整系统' #a.create_name=""
order by a.workday,d.name
```

#### 3.查询所有项目工时

```sql
SELECT d.name "部门名称",e.project_name "项目名称",e.project_no "项目编号",a.content "工时内容",
a.workday "日志日期",
a.create_name "员工姓名",b.duration "工时时长",
(case when b.type='BMGS' then '部门工时'
	when
 b.type='XMGS' then '项目工时'
	when b.type='QJGS' then '请假工时'
	when b.type='XZGS'
 then '协作工时'
when b.type='TXGS' then '调休工时'
	else b.type end) "工时类别" 
FROM
 `frame-tloa`.t_working_record_main a 
left join t_working_record_sub b on a.id=b.record_id
 left
 join sys_organ d on b.department_id=d.id
 left join t_project_project e on e.id=b.project_id
where a.workday>='2020-05-01' and a.workday<='2020-05-31'
and a.`status`='1' and
 b.duration is not null
order by a.workday,d.name
```

#### 4.查询费用报销明细表中包含字段的信息

```sql
#申请人，部门，金额，日期，单据编号，项目名称
#明细费用事项描述选择项目奖金的
select 
b.sponsor as '申请人', 
(case when b.ora_depart='93' then '商务部_商务'
when  b.ora_depart='27' then '软件项目部'
else b.ora_depart end) as '费用归属部门',
b.ora_totalamount as '报销总金额',
b.create_Time as '创建时间',
b.ora_no as '单据编号',
c.project_name as '项目名称'
from oa_reimburse_approvedail a 
left join oa_reimburse_approve b 
on a.orad_pid = b.ora_id
left join view_xmgl_project_records c 
on a.orad_projid = c.id
where a.orad_content = '项目奖金' and b.`status`=0 and a.orad_status=0 
and b.create_Time>='2021-01-01' and b.create_Time<='2021-02-04' and b.approve_status in ('流程结束','出纳','财务主管审批')
```

#### 5.查询有关项目信息的报销单据号和报销类型

```mysql
select b.sponsor         "报销人",
       a.orad_date       "日期",
       c.project_name    "项目名称",
       c.contract_no     "项目编号",
       a.orad_content    "报销事项",
       a.orad_amount1    "报销金额",
       a.orad_type       "款项类别",
       b.ora_approvetype "报销类别",
       b.ora_no          "报销单号",
       b.approve_uid     "当前审批人",
       b.approve_status  "当前审批环节"
from oa_reimburse_approvedail a
         left join oa_reimburse_approve b on a.orad_pid = b.ora_id
         left join view_xmgl_project_records c on a.orad_projid = c.id
where c.contract_no = '1.44.12.202011.007'
  and orad_status = 0
  and b.approve_status = 0
  and b.ora_approvetype in ('费用报销','差旅报销')
  and b.approve_status not in ('申请已撤销', '申请人修改')
GROUP By b.ora_no 
```

#### 6.数据库表备份

```sql
CREATE TABLE oa_reimburse_approve_xz_copy (SELECT * FROM oa_reimburse_approve_xz) 
    			#备份表名								#原表名
```

#### 7.查询运营加班申请待办审批人当前单据

```sql
SELECT b.user_name as '申请人' , b.user_organ_name as '申请人部门',b.create_time as '申请时间' FROM  t_sys_todo c
left JOIN t_administrator_workovertime b
on c.INSTANCE_ID = b.instance_id
where  b.delete_flag = '0' and b.`status` = '2' and c.DELETE_TAG = '0' 
and c.TODO_HANDLE_IS = '0' and c.TODO_HANDLE_IDS like '%,97,%'
```



## 2、账号开通笔记

### OA及运营系统账户开通流程

进入OA系统——运营系统——用户管理——新增用户

OA和运营系统互通，因此在运营注册即可登录OA

![1602559910905](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602559910905.png)

### 工时系统账户开通流程

1. 进入工时系统——组织管理——系统用户——新增![1602818211395](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602818211395.png)
2. 工时系统需要在数据库操作，进入tl-gyxxk数据库——通过查询用户名搜索用户id——进入frame-tloa工时数据库——在xt_id这一列加入用户id——保存![1602570565248](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602570565248.png)![1602570542562](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602570542562.png)

3. 进入oaproject数据库——新增用户角色（33：普通员工；44：项目主管）——保存![1603091240379](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603091240379.png)



## 3、工时超时更改时间限制笔记

1. 进入OA系统——工时管理系统——工时管理——选择当天日期![1602560385094](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560385094.png)
2. 找到该用户——设置该用户权限 ——设置工时限制天数![1602560473458](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560473458.png)
3. 查看规则——日期一般填写当天的日期——根据用户超时天数设置有效时间——保存![1602560599032](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560599032.png)



## 4、新增或修改项目（成员）笔记

1. 进入工时日志系统——项目管理——项目信息——查询是否存在该项目，若无，则新增项目![1602560796986](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560796986.png)
2. 若要修改项目经理，则如下操作![1602560845527](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560845527.png)
3. 添加项目成员——保存![1602560869098](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602560869098.png)



## 5、项目管理及项目扩展新增操作

1. 进入项目管理信息表(t_xmxx)——查询xmbh——若无——新增![1602574392743](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602574392743.png)
2. **进入项目扩展信息主表**(t_project_info)——查询priject code及is history ——若无——新增——复制ID——进入项目扩展信息表(t_project_info_ext)+——输入uuid及复制好的ID——保存![1602574973405](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602574973405.png)

![1602575177714](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602575177714.png)



## 6、部门新增操作笔记

### OA部门新增操作

1. 进入OA——切换权限系统![1602643063908](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602643063908.png)
2. 点击组织——组织管理——选择对应的父部门——填写要新增的部门名称（编号任意）——点击新增部门![1602643657388](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602643657388.png)

### 运营部门新增操作

1. 进入运营系统——系统管理——部门管理——选择父节点部门——输入信息——点击新增![1602810883576](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602810883576.png)![1602810836157](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602810836157.png)

## 7、同略官网新增招聘信息笔记

1. 进入官网后台——选择系统管理——CMS内容管理——招聘岗位![1602666266518](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602666266518.png)

2. 新增/编辑——输入该填信息——保存![1602666342315](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602666342315.png)

   ![1602666354864](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602666354864.png)



## 8、员工账号在三大系统禁用操作

1. 进入OA系统——权限管理系统——用户管理——搜索指定人——禁止登录![1602724159255](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602724159255.png)
2. 进入OA系统——工时系统——组织管理——系统用户——搜索指定人——禁用并且隐藏![1602724302806](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602724302806.png)
3. 进入OA系统——运营系统——系统管理——用户管理——搜索指定人——禁用![1602724395301](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602724395301.png)



## 9、新增字典操作笔记

1. 进入OA系统——权限管理系统——数据——字典管理——找到指定选项——新增![1602726736982](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602726736982.png)
2. 字典纸和排序顺序递增![1602726788758](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602726788758.png)

## 10、采购物品图片上传

1. 进入运营系统——物品采购——物品维护——按编号搜索查询 ![1602811299984](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602811299984.png)
2.  禁用的不管——编辑——文件上传——保存<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1602811431776.png" alt="1602811431776"  />

 

## 11、采购单作废操作笔记

1. 进入运营系统——采购单管理——按条件查询——复制单据号![1603075289427](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603075289427.png)

2. 进入数据库的运营库（frame-szh）——采购表（t_purchase_apply）——筛选单据号——更改status为99——保存

   ![1603075498806](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603075498806.png)



## 12、职务新增操作笔记

1. 进入oa系统——权限系统——数据——字典管理——职位——新增字典![1603091409643](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603091409643.png)

2. 进入运营系统——系统管理——数据字典——系统码——系统用户职务——新增——保存——更新缓存

![1603091598982](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603091598982.png)



## 13、公开和隐藏咨询部操作笔记

1. 进入frame_tloa数据库——sys_organ——按条件查询——设置type值为1——保存![1603091837892](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603091837892.png)



## 14、解决报销审核不了的问题 

通过查找同略或协政的报销表——复制pro_int_id——代办表——如下操作

![1603437977303](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603437977303.png)



## 15、 修改用户的正确部门编号

进入tl_gyxxk数据库——upms_organization表——查找相关部门及对应id

![1603438232569](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603438232569.png)



## 16、报销名下申请转移操作

1. 进入oaproject数据库——act_ru_task、act_hi_actinst、oa_reimburse approve——根据关键字操作这三个表![1603694937710](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603694937710.png)

## 17、修改物品价格

![1603779298466](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603779298466.png)



## 18、修改费用报销

1. 进入其中一个表搜索![1603793238343](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603793238343.png)
2.  复制主表的id，用关联字段查就查到了（两个都要）![1603793263960](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1603793263960.png)

## 19 项目代码拉取

OA系统   https://120.76.41.162:8002/svn/tl_products/e_oa/07Develop/TlOa/ProjectCode/TloaSpringCloud

配置文件    https://120.76.41.162:8002/svn/tl_products/e_oa/07Develop/TlOa/Config 

运营系统    https://120.76.41.162:8002/svn/tl_products/base/jcpt_product/07Develop/projects/frame-szh 

![1605681132206](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1605681132206.png)

![1605693690575](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1605693690575.png)

## 20 修改http证书

 替换两个文件![img](file:///C:\Users\Administrator\Documents\Tencent Files\1324747110\Image\Group2\}H\UL\}HULCC8S]TH$7VEEFIIFDHD.png) 

要修改的地方

![1611107073795](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1611107073795.png)

## 21  同步禅道 项目信息

状态为草稿的改为激活

![1614042540682](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614042540682.png)

关联需求

![1614042629528](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614042629528.png)

选择刚刚激活的点击保存

![1614042597307](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614042597307.png)

 分配任务 ，点击右上角的批量创建， 选择完相关需求，点那个箭头，会把任务名称和任务描述补充好给你，你不用修改 

![1614042683670](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614042683670.png)

分解任务

![1614042772453](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614042772453.png)关闭任务

![1614240060488](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1614240060488.png)

## 22